<!DOCTYPE html>
<html lang="en">

<!--
  Copyright 2014 Pants project contributors (see CONTRIBUTORS.md).
  Licensed under the Apache License, Version 2.0 (see LICENSE).
-->

<head>
  <meta charset="utf-8" />
  <title>JVM Artifact Release Process</title>
  <link rel="stylesheet" href="s.css">
  <script src="s.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="logo.ico">
  <!-- In case this is a "test publish", tell search engines where real version lives: -->
  <link rel="canonical" href="https://pantsbuild.github.io/release_jvm.html">
</head>

<body>

<div id="navtoggler">
&#x25c4; <!-- triangle -->
</div>
<div class="mainflow">
<nav class="breadcrumbs">
<ul>
<li><a href="index.html">Pants Build</a>
<li><a href="dev.html">Pants Developer Center</a>
<li><a href="release.html">Release Process</a>
<li><a href="release_jvm.html">JVM Artifact Release Process</a>
</ul>
</nav>

<nav class="pagetoc">
<ul>
<li class="toc-h1"><a href="#prerequisites">Prerequisites</a></li>
<li class="toc-h1"><a href="#dry-run">Dry Run</a></li>
<li class="toc-h1"><a href="#staging-to-ossrh">Staging to OSSRH</a></li>
<li class="toc-h1"><a href="#promoting-to-maven-central">Promoting to Maven Central</a></li>
<li class="toc-h1"><a href="#dogfood">Dogfood</a></li>
<li class="toc-h1"><a href="#releasers">Releasers</a></li>
</ul>
</nav>

<!-- main content start -->
<!-- generated by pants! -->
<style>
.codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f0f0f0; }
.codehilite .c { color: #60a0b0; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #007020; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #007020 } /* Comment.Preproc */
.codehilite .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #808080 } /* Generic.Output */
.codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0040D0 } /* Generic.Traceback */
.codehilite .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #007020 } /* Keyword.Pseudo */
.codehilite .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #902000 } /* Keyword.Type */
.codehilite .m { color: #40a070 } /* Literal.Number */
.codehilite .s { color: #4070a0 } /* Literal.String */
.codehilite .na { color: #4070a0 } /* Name.Attribute */
.codehilite .nb { color: #007020 } /* Name.Builtin */
.codehilite .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.codehilite .no { color: #60add5 } /* Name.Constant */
.codehilite .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #007020 } /* Name.Exception */
.codehilite .nf { color: #06287e } /* Name.Function */
.codehilite .nl { color: #002070; font-weight: bold } /* Name.Label */
.codehilite .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #062873; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #bb60d5 } /* Name.Variable */
.codehilite .ow { color: #007020; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #40a070 } /* Literal.Number.Float */
.codehilite .mh { color: #40a070 } /* Literal.Number.Hex */
.codehilite .mi { color: #40a070 } /* Literal.Number.Integer */
.codehilite .mo { color: #40a070 } /* Literal.Number.Oct */
.codehilite .sb { color: #4070a0 } /* Literal.String.Backtick */
.codehilite .sc { color: #4070a0 } /* Literal.String.Char */
.codehilite .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4070a0 } /* Literal.String.Double */
.codehilite .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #4070a0 } /* Literal.String.Heredoc */
.codehilite .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.codehilite .sx { color: #c65d09 } /* Literal.String.Other */
.codehilite .sr { color: #235388 } /* Literal.String.Regex */
.codehilite .s1 { color: #4070a0 } /* Literal.String.Single */
.codehilite .ss { color: #517918 } /* Literal.String.Symbol */
.codehilite .bp { color: #007020 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #bb60d5 } /* Name.Variable.Class */
.codehilite .vg { color: #bb60d5 } /* Name.Variable.Global */
.codehilite .vi { color: #bb60d5 } /* Name.Variable.Instance */
.codehilite .il { color: #40a070 } /* Literal.Number.Integer.Long */
</style>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h1 id="jvm-artifact-release-process">JVM Artifact Release Process</h1></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#jvm-artifact-release-process">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>This page describes how to make a versioned release of the Pants jvm
tools to Maven Central.</p>
<p>Releasing jvm tools largely follows the
<a href="publish.html">standard jar publishing process</a>, but has
some non-standard initial one-time setup.</p>
<p>At a high level, releasing pants jvm artifacts involves:</p>
<ul>
<li>Deciding when to release.
    At present this is ad-hoc, typically when
    a change has been made to a tool and the author wants to use a
    version incorporating that change.</li>
<li>(optional) Perform a release <a href="#dry-run">dry run</a>.</li>
<li><a href="#staging-to-ossrh">Staging</a> the release to OSSRH.</li>
<li><a href="#promoting-to-maven-central">Promoting</a> the release to Maven Central.</li>
<li><a href="#dogfood">Dogfood</a> the release.</li>
</ul>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="prerequisites">Prerequisites</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#prerequisites">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>You must be at least a
<a href="https://github.com/orgs/pantsbuild/teams/committers">committer</a> in
the pantsbuild GitHub organisation to publish pants artifacts.  If you
aren't yet, you need only ping the
<a href="https://groups.google.com/forum/#!forum/pants-devel">pants-devel</a>
group to inquire about getting a release performed.</p>
<p>If you are a committer, there are four additional requirements to
satisfy in order to be able publish to Maven Central:</p>
<ul>
<li>
<p>Create and publish a pgp key if you don't already have a published
    pgp key. There is nothing Maven Central specific about this, but
    Sonatype does provide
    <a href="http://central.sonatype.org/pages/working-with-pgp-signatures.html">some instructions</a>
    you might follow.</p>
</li>
<li>
<p><a href="https://issues.sonatype.org/secure/Signup!default.jspa">Create a sonatype.org JIRA account</a>
    if you don't already have one.</p>
</li>
<li>
<p>Ask an existing Pants Maven Central <a href="#releasers">releaser</a> to
    create a sonatype.org JIRA ticket to get you added to the
    org.pantsbuild maintainers.  You'll need to give them your
    sonatype.org JIRA account id. Here's an
    <a href="https://issues.sonatype.org/browse/OSSRH-12754">example ticket</a>
    they can use as a template.  Once this is done and you've performed
    your 1st release, add yourself to the <a href="#releasers">Releasers</a>
    section below.</p>
</li>
<li>
<p>Create a <code>~/.config/pants/release/jvm/pgp.properties</code> file to store the
    credentials Pants needs to sign artifacts uploaded to sonatype.org.
    This process is <a href="#pgp-credentials">described below</a>.</p>
</li>
<li>
<p>Create an entry in your <code>~/.netrc</code> file to enable authentication to Sonatype.</p>
<div class="codehilite"><pre>machine oss.sonatype.org
  login jsirois
  password XYX
</pre></div>
</li>
</ul>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h3 id="pgp-credentials">PGP Credentials</h3></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#pgp-credentials">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>Artifacts released to Maven Central must be pgp-signed.  In order to
sign artifacts, the pants jar publishing process currently needs access
to your pgp key passphrase via file (There is an issue
<a href="https://github.com/pantsbuild/pants/issues/1407">here</a> tracking a better
solution).</p>
<p>First you'll need to create a secure
<a href="https://docs.oracle.com/javase/6/docs/api/java/util/Properties.html#load(java.io.Reader)">java properties file</a>
to hold your pgp credentials:</p>
<div class="codehilite"><pre><span class="nv">$ </span>mkdir -p ~/.config/pants/release/jvm <span class="o">&amp;&amp;</span> <span class="se">\</span>
  touch ~/.config/pants/release/jvm/pgp.properties <span class="o">&amp;&amp;</span> <span class="se">\</span>
  chmod 600 ~/.config/pants/release/jvm/pgp.properties
</pre></div>
<p>The properties file supports the following keys with noted defaults if omitted:</p>
<ul>
<li>
<p><code>pgp.secring</code></p>
<p>Assumes your pgp implementation is gpg and defaults to <code>~/.gnupg/secring.gpg</code></p>
</li>
<li>
<p><code>pgp.keyid</code></p>
<p>Defaults to <code>auto</code>.  If you're unsure which pgp key <code>auto</code> will
select and you use gpg, you can determine the key id and verify the
passphrase in one fell swoop with the following command:</p>
<div class="codehilite"><pre><span class="nv">$ </span>killall gpg-agent; <span class="nb">echo</span> | gpg --sign -vv &gt;/dev/null
gpg: using PGP trust model
gpg: key 67B5C626: accepted as trusted key
gpg: no running gpg-agent - starting <span class="s1">'/usr/bin/gpg-agent'</span>
gpg: waiting <span class="k">for </span>the agent to come up ... <span class="o">(</span>5s<span class="o">)</span>
gpg: connection to agent established
<span class="o">[</span>pinentry prompts <span class="k">for </span>passphrase<span class="o">]</span>
gpg: writing to stdout
gpg: RSA/SHA256 signature from: <span class="s2">"67B5C626 John Sirois &lt;john.sirois@gmail.com&gt;"</span>
</pre></div>
<p>In this case the default key id is <code>67B5C626</code>.  You can add an entry
to the properties file instead of relying on the default <code>auto</code>
setting if you prefer to be explicit like so:</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">echo </span>pgp.keyid<span class="o">=</span>67B5C626 &gt;&gt; ~/.config/pants/release/jvm/pgp.properties
</pre></div>
</li>
<li>
<p><code>pgp.password</code></p>
<p><strong>This key is required</strong>, you must use the passphrase of the pgp
key identified by <code>pgp.keyid</code> as the value.  If you did not specify
a <code>pgp.keyid</code> then this should be the passphrase for your default
pgp key.</p>
</li>
</ul>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="dry-run">Dry Run</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#dry-run">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>Releases should only be published from master, so get on master and
ensure the changes you want to publish are present. After confirming
this, you can test out the publish in 2 ways:</p>
<ol>
<li>
<p>A dry run to get a preview of what will be published and why:</p>
<div class="codehilite"><pre><span class="nv">$ </span>./pants clean-all publish.jar src/<span class="o">{</span>java,scala<span class="o">}</span>::
</pre></div>
</li>
<li>
<p>A local publish to get a preview of both what will be published
     and why as well as the changelogs:</p>
<div class="codehilite"><pre><span class="nv">$ </span>./pants clean-all publish.jar --no-dryrun --local<span class="o">=</span>/tmp/m2 src/<span class="o">{</span>java,scala<span class="o">}</span>::
</pre></div>
<p>Note that this "dry-run" technique somewhat confusingly passes
 <code>--no-dryrun</code> but only because the publish is local and to a
 temporary dir (the argument to <code>--local</code>).  You can also poke
 around in the <code>/tmp/m2</code> local maven repo if you're curious or want
 to double-check fine details of exactly what will be pushed.</p>
</li>
</ol>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="staging-to-ossrh">Staging to OSSRH</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#staging-to-ossrh">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>When you're ready to publish to Maven Central, the 1st step is to
publish the jvm tool jars to Sonatype's OSSRH staging repository.  Note
that nothing will actually go live until the staging repository is
<a href="#promoting-to-maven-central">released by you later</a>, so this step has
no consequences of global importance.  Pants will create and push git
tags for the staging releases you do here, but in the worst case the
tags will point to releases never promoted to Maven Central, which is
fine.</p>
<p>To do the staging release, it's a normal pants publish and it's easiest
to use the following command, which will publish everything that's
changed and only those things that have changed since the last publish:</p>
<div class="codehilite"><pre><span class="nv">$ </span>./pants publish.jar --no-dryrun src/<span class="o">{</span>java,scala<span class="o">}</span>::
</pre></div>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="promoting-to-maven-central">Promoting to Maven Central</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#promoting-to-maven-central">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>With the jvm tools published to the Sonatype OSSRH staging repository,
you'll need to complete the release using Sonatype's OSSRH Nexus
repository manager web UI.  Sonatype describes the process
<a href="http://central.sonatype.org/pages/releasing-the-deployment.html">here</a>
but the process is also described below:</p>
<ol>
<li>
<p>Log into Sonatype's OSSRH Nexus repository manager web UI.</p>
<p>You do this <a href="https://oss.sonatype.org/#stagingRepositories">here</a>.
 You should use the the same user id and password you use to login
 to the Sonatype JIRA server.</p>
</li>
<li>
<p>Find the staging repository auto-created when you
     <a href="#staging-to-ossrh">staged the release</a> above.</p>
<p>As shown below, in the 'Staging Repositories' tab enter
 <code>pantsbuild</code> in the search box in the upper-right corner to filter
 the display to your staging repository.</p>
<p><img alt="image" src="images/ossrh-publish-find-staging-repo.png"/></p>
<p>There should be exactly one repository listed and you should
 select its checkbox.</p>
</li>
<li>
<p>Close the selected staging repository.</p>
<p>As shown below, with the staging repository selected, there will
 be a 'Close' button available.  Look for in in the menu bar across
 the top of the repository list.  Click it.</p>
<p><img alt="image" src="images/ossrh-publish-close-staging-repo.png"/></p>
<p>This will trigger a validation process that checks the staged
artifacts for signatures, a valid POM and more.  When validation is
complete, you'll receive an email from nexus@oss.sonatype.org with
the subject 'Nexus: Staging Completed'.  You may need to click the
'Refresh' button in the UI to see the 'Close' button transition to
a disabled state and the 'Release' button to its right transition
to an enabled state.</p>
</li>
<li>
<p>Release the selected staging repository.</p>
<p>As shown below, with the staging repository selected and closed,
there will be a 'Release' button available.  Click it.</p>
<p><img alt="image" src="images/ossrh-publish-release-staging-repo.png"/></p>
<p>This will trigger another round of artifact validation and another
email, this time with subject 'Nexus: Promotion Completed'.  At
this point you're all done and just need to wait ~10 minutes for
the artifacts to be available in Maven Central and ~2 hours to show
up in the
<a href="http://search.maven.org/#search%7Cga%7C1%7Corg.pantsbuild">search index</a>.</p>
</li>
</ol>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="dogfood">Dogfood</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#dogfood">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>Check Maven Central to ensure everything looks good. You can browse the
<a href="https://repo1.maven.org/maven2/org/pantsbuild">org.pantsbuild subtree</a>
to find the artifact(s) you just released.  Once available you can send
out an RB bumping the versions of the released tools in <code>BUILD.tools</code>.</p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="releasers">Releasers</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#releasers">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>The following folks are set up to publish to Maven Central for
org.pantsbuild:</p>
<ul>
<li>David Turner <a href="mailto:dturner@twopensource.com">dturner@twopensource.com</a></li>
<li>Eric Ayers <a href="mailto:ericzundel@gmail.com">ericzundel@gmail.com</a></li>
<li>John Sirois <a href="mailto:john.sirois@gmail.com">john.sirois@gmail.com</a></li>
<li>Stu Hood <a href="mailto:stuhood@gmail.com">stuhood@gmail.com</a></li>
</ul>

<!-- main content end -->

<div class="generated">
Generated by <a href="http://pantsbuild.github.io/docs.html">publish_docs</a>
from dist/markdown/html/src/python/pants/docs/release_jvm.html 2015-11-30T12:11:28.676657
</div>

</div> <!-- end of mainflow -->

<nav class="bignav">
  <div class="bignav-logo">
    <a href="index.html">
      <img src="logo.ico" alt="[pantsbuild logo]">
    </a>
  </div>
  <form class="search" action="https://www.google.com/search">
  <input name="as_q" class="query" placeholder="Search">
  <input name="as_sitesearch" value="pantsbuild.github.io" type="hidden">
  </form>

<div class="site-toc">
<ul>
<li class="toc-h1 ">
<a href="first_concepts.html">Pants Conceptual Overview</a>
</li>
<li class="toc-h1 ">
<a href="install.html">Installing Pants</a>
</li>
<li class="toc-h1 ">
<a href="first_tutorial.html">First Tutorial</a>
</li>
<li class="toc-h1 ">
<a href="target_addresses.html">Target Addresses</a>
</li>
<li class="toc-h1 ">
<a href="JVMProjects.html">JVM Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="scala.html">Scala Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="from_maven.html">Pants for Maven Experts</a>
</li>
<li class="toc-h1 ">
<a href="python-readme.html">Python Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_py.html">Python 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="pex_design.html">PEX Design</a>
</li>
<li class="toc-h1 ">
<a href="page.html">README Files and Markdown</a>
</li>
<li class="toc-h1 ">
<a href="build_files.html">BUILD files</a>
</li>
<li class="toc-h1 ">
<a href="invoking.html">Invoking Pants Build</a>
</li>
<li class="toc-h1 ">
<a href="tshoot.html">Troubleshooting</a>
</li>
<li class="toc-h1 ">
<a href="3rdparty.html">Third-Party Dependencies</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_py.html">Python 3rdparty Pattern</a>
</li>
<li class="toc-h1 ">
<a href="ThriftDeps.html">Using Pants with Thrift Dependencies</a>
</li>
<li class="toc-h1 ">
<a href="publish.html">Publishing Artifacts</a>
</li>
<li class="toc-h1 ">
<a href="with_emacs.html">Emacs With Pants</a>
</li>
<li class="toc-h1 ">
<a href="with_intellij.html">Using Pants with IntelliJ IDEA</a>
</li>
<li class="toc-h1 ">
<a href="setup_repo.html">Set up Your Source Tree for Pants</a>
</li>
<li class="toc-h1 ">
<a href="build_dictionary.html">Pants BUILD Dictionary</a>
</li>
<li class="toc-h1 ">
<a href="options_reference.html">Pants Options Reference</a>
</li>
<li class="toc-h1 ">
<a href="changelog.html">RELEASE HISTORY</a>
</li>
<li class="toc-h1 ">
<a href="export.html">Export Format</a>
</li>
<li class="toc-h1 ">
<a href="dev.html">Pants Developer Center</a>
</li>
<li class="toc-h2 ">
<a href="howto_contribute.html">Pants Contributors Guide</a>
</li>
<li class="toc-h2 ">
<a href="howto_ask.html">How To Ask</a>
</li>
<li class="toc-h2 ">
<a href="howto_develop.html">Pants Developers Guide</a>
</li>
<li class="toc-h2 ">
<a href="dev_tasks.html">Task Developer's Guide</a>
</li>
<li class="toc-h3 ">
<a href="dev_tasks_publish_extras.html">Develop a Task to Publish &quot;Extra&quot; Artifacts</a>
</li>
<li class="toc-h2 ">
<a href="howto_plugin.html">Developing a Pants Plugin</a>
</li>
<li class="toc-h2 ">
<a href="intellij.html">Pants Development with IntelliJ IDEA</a>
</li>
<li class="toc-h2 ">
<a href="internals.html">Pants Internals</a>
</li>
<li class="toc-h2 ">
<a href="release.html">Release Process</a>
</li>
<li class="toc-h3 toc-here">
JVM Artifact Release Process
</li>
<li class="toc-h2 ">
<a href="docs.html">About the documentation</a>
</li>
<li class="toc-h2 ">
<a href="credits.html">Credits</a>
</li>
</ul>
</div>
</nav>

<div class="ci-status">
<a href="https://travis-ci.org/pantsbuild/pants">
<img src="https://travis-ci.org/pantsbuild/pants.png?branch=master"
     alt="Are the tests passing?" title="Are the tests passing?"></a><br>
<a href="https://coveralls.io/r/pantsbuild/pants?branch=master">
<img src="https://coveralls.io/repos/pantsbuild/pants/badge.png?branch=master"
     alt="Test Coverage Status" title="Test Coverage Status"></a>
</div>

</body>
</html>
